<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="CarFume - премиальные деревянные ароматизаторы для автомобиля. Натуральное дерево, войлок и эксклюзивные композиции.">
    <title>CarFume - Аромат Вашего Статуса | Премиальные автомобильные ароматизаторы</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --black-velvet: #000000;
            --white: #FFFFFF;
            --silver: #C0C0C0;
            --silver-light: #F0F0F0;
            --silver-dark: #A8A8A8;
            --wood-brown: #8B4513;
            --soft-gray: #E0E0E0;
            --shadow: rgba(192, 192, 192, 0.3);
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Georgia', serif;
            background-color: var(--black-velvet);
            color: var(--white);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Typography */
        h1, h2, h3 {
            font-family: 'Playfair Display', 'Georgia', serif;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        p, button, a {
            font-family: 'Arial', 'Helvetica', sans-serif;
        }

        /* Navigation */
        nav {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            z-index: 1000;
            padding: 20px 0;
            transition: all 0.3s ease;
        }

        nav.scrolled {
            padding: 10px 0;
            box-shadow: 0 2px 20px rgba(192, 192, 192, 0.2);
        }

        nav .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 40px;
        }

        .logo {
            font-size: 28px;
            font-weight: bold;
            color: var(--silver) !important;
            letter-spacing: 3px;
        }

        .nav-links {
            display: flex;
            gap: 30px;
            list-style: none;
        }

        .nav-links a {
            color: var(--silver) !important;
            text-decoration: none;
            font-size: 14px;
            letter-spacing: 1px;
            transition: color 0.3s ease;
        }

        .nav-links a:hover {
            color: var(--silver-light) !important;
        }

        /* Sections */
        section {
            min-height: auto;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 30px 40px; /* компактнее вертикальные отступы (≈ в 2 раза меньше) */
            position: relative;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.7)), url('https://drive.google.com/uc?export=download&id=1_osZ6U8leRJWb0fMTUf2UqaflKvNZ-Ox') center/cover no-repeat;
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            text-align: center;
            position: relative;
            min-height: 100vh;
        }

        .hero-content {
            z-index: 10;
            position: relative;
            animation: fadeInUp 1.2s ease;
        }

        .hero h1 {
            font-size: 72px;
            margin-bottom: 30px;
            color: var(--silver);
            text-shadow: 2px 2px 20px rgba(192, 192, 192, 0.5);
        }

        .hero .subheading {
            font-size: 24px;
            margin-bottom: 50px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            color: var(--soft-gray);
            line-height: 1.8;
        }

        .cta-button {
            display: inline-block;
            background: #000000;
            color: #C0C0C0 !important;
            padding: 18px 50px;
            font-size: 16px;
            letter-spacing: 2px;
            text-transform: uppercase;
            text-decoration: none;
            border: 2px solid transparent;
            background-image: linear-gradient(#000000, #000000), linear-gradient(135deg, #C0C0C0, #F0F0F0, #C0C0C0, #A8A8A8);
            background-origin: border-box;
            background-clip: padding-box, border-box;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.4s ease;
            font-weight: bold;
            box-shadow: 0 5px 30px rgba(192, 192, 192, 0.3), inset 0 0 20px rgba(192, 192, 192, 0.1);
        }

        .cta-button:hover {
            background-image: linear-gradient(135deg, #C0C0C0, #F0F0F0, #C0C0C0), linear-gradient(135deg, #000000, #1a1a1a, #000000);
            transform: translateY(-3px);
            box-shadow: 0 8px 40px rgba(192, 192, 192, 0.6), inset 0 0 30px rgba(0, 0, 0, 0.5);
            color: #000000 !important;
        }

        .cta-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .cta-button:disabled:hover {
            transform: none;
            box-shadow: 0 5px 30px rgba(192, 192, 192, 0.3), inset 0 0 20px rgba(192, 192, 192, 0.1);
        }

        /* Premium Materials Section */
        .materials {
            background: linear-gradient(rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.9)), url('https://drive.google.com/uc?export=download&id=1_osZ6U8leRJWb0fMTUf2UqaflKvNZ-Ox') center/cover no-repeat;
            background-attachment: fixed;
            min-height: 100vh;
        }

        .section-title {
            text-align: center;
            font-size: 56px;
            margin-bottom: 20px; /* ещё меньше расстояние под заголовком */
            color: var(--silver);
            position: relative;
        }

        .section-title::after {
            content: '';
            display: block;
            width: 100px;
            height: 3px;
            background: var(--silver);
            margin: 30px auto 0;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); /* как каталоге */
            align-items: start;
            gap: 20px;
            margin-top: 24px;
        }

        .feature-card {
            background: transparent;
            border: none;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(192, 192, 192, 0.1), transparent);
            transition: left 0.6s ease;
        }

        .feature-card:hover::before {
            left: 100%;
        }

        .feature-card:hover {
            transform: translateY(-10px);
            border-color: transparent; /* не подсвечиваем рамку на ховере */
            box-shadow: 0 15px 50px rgba(192, 192, 192, 0.3);
        }

        .feature-icon {
            width: 120px;
            height: 120px;
            margin: 0 auto 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .feature-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 10px;
        }

        .feature-card h3 {
            font-size: 18px;
            margin-bottom: 8px;
            color: var(--silver);
        }

        .feature-card p { display: none; }

        /* Product Catalog */
        .catalog {
            background: linear-gradient(rgba(0, 0, 0, 0.85), rgba(0, 0, 0, 0.95)), url('https://drive.google.com/uc?export=download&id=1_osZ6U8leRJWb0fMTUf2UqaflKvNZ-Ox') center/cover no-repeat;
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            padding: 60px 40px; /* меньше вертикальный отступ */
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px; /* как референсная ширина/промежуток */
            margin-top: 32px;
        }

        .product-card {
            background: transparent;
            border: none;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-5px);
        }

        .product-image {
            width: 100%;
            height: 350px;
            object-fit: cover;
            transition: all 0.4s ease;
            background: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .product-image img {
            transition: all 0.4s ease;
        }

        .product-card:hover .product-image {
            transform: scale(1.1);
        }

        .product-card:hover .product-image img {
            filter: drop-shadow(0 0 30px rgba(192, 192, 192, 0.8)) drop-shadow(0 0 60px rgba(192, 192, 192, 0.4));
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            padding: 20px;
        }

        .product-info {
            padding: 30px;
            position: relative;
            z-index: 1;
            background: transparent;
        }

        .product-name {
            font-size: 24px;
            margin-bottom: 15px;
            color: var(--silver);
            letter-spacing: 1px;
        }

        .product-description {
            font-size: 15px;
            color: var(--soft-gray);
            line-height: 1.6;
        }

        /* Usage Experience */
        .experience {
            background: linear-gradient(rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.9)), url('https://drive.google.com/uc?export=download&id=1_osZ6U8leRJWb0fMTUf2UqaflKvNZ-Ox') center/cover no-repeat;
            background-attachment: fixed;
        }

        .steps-container {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 20px;
            margin-top: 32px;
        }

        .step-card {
            text-align: center;
            position: relative;
        }

        .step-number {
            width: 56px;
            height: 56px;
            background: var(--silver);
            color: var(--black-velvet);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            font-weight: bold;
            margin: 0 auto 10px;
            box-shadow: 0 5px 30px rgba(192, 192, 192, 0.5);
        }

        .step-image {
            width: 100%;
            height: 120px;
            background: rgba(255, 255, 255, 0.05);
            margin-bottom: 8px;
            border: 1px solid rgba(192, 192, 192, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            opacity: 0.35;
        }

        .step-card h3 {
            font-size: 14px;
            margin-bottom: 6px;
            color: var(--silver);
        }

        .step-card p { display: none; }

        /* Social Proof */
        .social-proof {
            background: linear-gradient(rgba(0, 0, 0, 0.85), rgba(0, 0, 0, 0.95)), url('https://drive.google.com/uc?export=download&id=1_osZ6U8leRJWb0fMTUf2UqaflKvNZ-Ox') center/cover no-repeat;
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }

        .testimonials-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); /* как у каталога */
            gap: 20px;
            margin-top: 32px;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
            width: 100%;
        }

        .testimonial-card {
            background: linear-gradient(145deg, #0f0f0f, #1a1a1a);
            border: 1px solid rgba(192, 192, 192, 0.2);
            padding: 14px;
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .testimonial-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 40px rgba(192, 192, 192, 0.2);
        }

        .testimonial-quote {
            font-size: 14px;
            font-style: italic;
            color: var(--soft-gray);
            margin-bottom: 10px;
            line-height: 1.6;
            display: -webkit-box;
            line-clamp: 2; /* standard property for compatibility */
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .testimonial-author {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .author-avatar {
            width: 60px;
            height: 60px;
            background: var(--silver);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: var(--black-velvet);
        }

        .author-info {
            flex: 1;
        }

        .author-name {
            font-weight: bold;
            color: var(--silver);
            margin-bottom: 5px;
        }

        .author-title {
            font-size: 14px;
            color: var(--soft-gray);
        }

        /* Where to Buy */
        .where-to-buy {
            background: linear-gradient(rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.9)), url('фонвойлок.jpg') center/cover no-repeat;
            background-attachment: fixed;
            padding-top: 0; /* убираем пустое расстояние сверху блока карты */
        }

        .map-container {
            width: 100%;
            height: 600px;
            min-height: 600px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(192, 192, 192, 0.3);
            border-radius: 15px;
            margin: 0 0 40px; /* без верхнего отступа над картой */
            overflow: hidden;
            box-shadow: 0 10px 50px rgba(192, 192, 192, 0.2);
            position: relative;
        }

        /* Google Maps styling */
        #map {
            width: 100%;
            height: 100%;
            border-radius: 15px;
        }

        /* Убираем кнопку Google, которая располагается над zoom (+ -): fullscreen/прочие */
        .gm-fullscreen-control { display: none !important; }
        .gm-svpc { display: none !important; } /* Street View (пегман) */


        .cta-center {
            text-align: center;
            margin-top: 40px;
        }

        /* Footer */
        footer {
            background: #000000;
            padding: 60px 40px 30px;
            border-top: 1px solid rgba(192, 192, 192, 0.2);
        }

        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 50px;
            margin-bottom: 40px;
        }

        .footer-section h3 {
            color: var(--silver);
            font-size: 20px;
            margin-bottom: 20px;
        }

        .footer-section p,
        .footer-section a {
            color: var(--soft-gray);
            font-size: 14px;
            line-height: 2;
            text-decoration: none;
            display: block;
        }

        .footer-section a:hover {
            color: var(--silver);
        }

        .social-links {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        .social-links a {
            width: 40px;
            height: 40px;
            background: rgba(192, 192, 192, 0.1);
            border: 1px solid rgba(192, 192, 192, 0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.3s ease;
        }

        .social-links a:hover {
            background: var(--silver);
            color: var(--black-velvet);
            transform: translateY(-3px);
        }

        .footer-bottom {
            text-align: center;
            padding-top: 30px;
            border-top: 1px solid rgba(192, 192, 192, 0.1);
            color: var(--soft-gray);
            font-size: 14px;
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Fallback: по умолчанию контент виден даже без JS-анимаций */
        .fade-in {
            opacity: 1;
            transform: translateY(0);
            transition: all 0.8s ease;
        }

        .fade-in.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Mobile Menu */
        .mobile-menu-toggle {
            display: none;
            flex-direction: column;
            gap: 5px;
            cursor: pointer;
        }

        .mobile-menu-toggle span {
            width: 30px;
            height: 3px;
            background: var(--silver);
            transition: all 0.3s ease;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 42px;
            }

            .hero .subheading {
                font-size: 18px;
                margin-bottom: 30px;
            }

            .section-title {
                font-size: 28px;
                margin-bottom: 32px;
            }

            /* 3 карточки в ряд на мобильных */
            .products-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 12px;
            }
            .features-grid,
            .testimonials-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 16px;
            }
            .steps-container { grid-template-columns: repeat(3, 1fr); gap: 16px; }
            .step-image { height: 100px; }
            .step-number { width: 54px; height: 54px; font-size: 24px; margin-bottom: 12px; }
            .testimonial-card { padding: 12px; }

            /* компактные карточки товара */
            .product-image { height: 140px; }
            .product-info { padding: 12px; }
            .product-name { font-size: 14px; }
            .product-description { display: none; }

            .nav-links {
                display: none;
            }

            .mobile-menu-toggle {
                display: flex;
            }

            nav .container {
                padding: 0 20px;
            }

            section {
                padding: 60px 20px;
            }
            .hero { padding: 60px 20px; }

            .cta-button {
                padding: 15px 40px;
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            .hero h1 {
                font-size: 32px;
            }

            .section-title {
                font-size: 22px;
                margin-bottom: 24px;
            }

            .products-grid { grid-template-columns: repeat(3, 1fr); gap: 10px; }
            .features-grid { grid-template-columns: repeat(3, 1fr); gap: 12px; }
            .steps-container { grid-template-columns: repeat(3, 1fr); gap: 10px; }
            .testimonials-grid { grid-template-columns: repeat(3, 1fr); gap: 10px; }
            .testimonial-card { padding: 12px; }
            .product-image { height: 120px; }
        }

        /* Force silver colors - высший приоритет */
        nav .nav-links a,
        nav ul li a {
            color: #C0C0C0 !important;
        }

        nav .nav-links a:hover,
        nav ul li a:hover {
            color: #F0F0F0 !important;
        }

        a.cta-button,
        .cta-button,
        .hero-content a.cta-button {
            color: #C0C0C0 !important;
        }

        a.cta-button:hover,
        .cta-button:hover,
        .hero-content a.cta-button:hover {
            color: #000000 !important;
        }

        .logo {
            color: #C0C0C0 !important;
        }

        /* Специальный стиль для кнопки "Найти ближайший магазин" */
        #findStoreBtn {
            background: linear-gradient(135deg, #C0C0C0, #F0F0F0, #C0C0C0);
            color: #000 !important; /* перекрываем общий стиль cta */
        }

        /* Короткое затемнение при нажатии (500мс) */
        #findStoreBtn.pressed-dark {
            background: #000000;
            color: #C0C0C0 !important;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 10000;
            overflow-y: auto;
            animation: fadeIn 0.3s ease;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }

        .modal-content {
            background: linear-gradient(145deg, #0a0a0a, #1a1a1a);
            border: 2px solid rgba(192, 192, 192, 0.3);
            border-radius: 12px;
            width: min(420px, 96vw);
            height: min(88vh, 680px);
            position: relative;
            overflow: hidden; /* всё строго внутри контура, без внутренних скроллов */
            animation: slideUp 0.2s ease;
            box-shadow: 0 20px 80px rgba(192, 192, 192, 0.3);
        }

        /* Custom scrollbar for modal */
        .modal-content::-webkit-scrollbar {
            width: 8px;
        }

        .modal-content::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
        }

        .modal-content::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #C0C0C0, #F0F0F0);
            border-radius: 10px;
        }

        .modal-content::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #F0F0F0, #C0C0C0);
        }


        /* убираем кнопку закрытия — закрываем по клику вне контента */
        .modal-close { display: none; }

        .modal-body {
            display: grid;
            grid-template-rows: auto 1fr auto auto; /* изображение | авто-текст | списки | кнопка */
            gap: 10px;
            padding: 12px;
            height: 100%;
            overflow: hidden; /* без внутренних скроллов */
        }

        .modal-image {
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border-radius: 10px;
            overflow: hidden;
            min-height: 34vh;
        }

        .modal-image img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 10px 40px rgba(192, 192, 192, 0.4));
        }

        .modal-info {
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            overflow: hidden; /* не выползает */
        }

        .modal-title {
            font-size: 20px;
            color: var(--silver);
            margin-bottom: 6px;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .modal-description {
            font-size: 13px;
            color: var(--soft-gray);
            line-height: 1.5;
            margin-bottom: 8px;
        }

        .modal-features { margin-bottom: 6px; overflow: hidden; }

        .modal-features h4 {
            font-size: 14px;
            color: var(--silver);
            margin-bottom: 6px;
            letter-spacing: 1px;
        }

        .modal-features ul {
            list-style: none;
            padding: 0;
        }

        .modal-features li {
            font-size: 13px;
            color: var(--soft-gray);
            padding: 5px 0;
            padding-left: 22px;
            position: relative;
        }

        .modal-features li::before {
            content: '✓';
            position: absolute;
            left: 0;
            color: var(--silver);
            font-size: 20px;
            font-weight: bold;
        }

        .modal-button {
            display: inline-block;
            background: linear-gradient(135deg, #C0C0C0, #F0F0F0, #C0C0C0);
            color: #000;
            padding: 12px 18px;
            font-size: 13px;
            letter-spacing: 2px;
            text-transform: uppercase;
            text-decoration: none;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            text-align: center;
            box-shadow: 0 5px 30px rgba(192, 192, 192, 0.4);
        }

        .modal-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 40px rgba(192, 192, 192, 0.6);
        }

        .modal-close-bottom {
            display: none;
            background: transparent;
            color: var(--silver);
            padding: 15px 30px;
            font-size: 14px;
            letter-spacing: 2px;
            text-transform: uppercase;
            text-decoration: none;
            border: 2px solid rgba(192, 192, 192, 0.3);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            text-align: center;
            margin-top: 10px;
            width: 100%;
        }

        .modal-close-bottom:hover {
            background: rgba(192, 192, 192, 0.1);
            border-color: var(--silver);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 5px 20px rgba(192, 192, 192, 0.5);
            }
            50% {
                transform: scale(1.1);
                box-shadow: 0 5px 30px rgba(192, 192, 192, 0.8);
            }
        }

        @media (max-width: 768px) {
            .modal-content { max-width: 92vw; max-height: 88vh; }
            .modal-image img { max-height: 36vh; }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav id="navbar">
        <div class="container">
            <div class="logo">CARFUME</div>
            <div class="mobile-menu-toggle">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <ul class="nav-links">
                <li><a href="#hero">Главная</a></li>
                <li><a href="#materials">Материалы</a></li>
                <li><a href="#catalog">Коллекция</a></li>
                <li><a href="#experience">Опыт</a></li>
                <li><a href="#testimonials">Отзывы</a></li>
                <li><a href="#buy">Где купить</a></li>
            </ul>
        </div>
    </nav>

    <!-- 1. Hero Section -->
    <section id="hero" class="hero">
        <div class="hero-content">
            <h1>АРОМАТ ВАШЕГО СТАТУСА</h1>
            <p class="subheading">Единственный автомобильный аксессуар, который чувствуют все. Натуральное дерево и войлок вместо химии.</p>
            <a href="#catalog" class="cta-button">ИССЛЕДОВАТЬ КОЛЛЕКЦИЮ</a>
        </div>
    </section>

    <!-- 2. Premium Materials Section -->
    <section id="materials" class="materials">
        <div class="container">
            <h2 class="section-title fade-in">ИСКУССТВО В ДЕТАЛЯХ</h2>
            <div class="features-grid">
                <div class="feature-card fade-in">
                    <div class="feature-icon">
                        <img src="https://lh3.googleusercontent.com/d/1epVa2oRE7nviYRHZvjR8rbV7W-0uCAaJ" alt="Натуральное дерево">
                    </div>
                    <h3>Натуральное дерево</h3>
                    <p>Каждый диффузор вручную обработан из премиальных пород дерева. Уникальная текстура и благородный аромат древесины создают неповторимую атмосферу.</p>
                </div>
                <div class="feature-card fade-in">
                    <div class="feature-icon">
                        <img src="https://lh3.googleusercontent.com/d/1AnSlz9GW3xOX6uvYArGTE-V_ODKoaPOg" alt="Войлочный сердечник">
                    </div>
                    <h3>Войлочный сердечник</h3>
                    <p>Специальный войлочный вкладыш обеспечивает равномерное распределение аромата на протяжении 4-6 недель. Без резких запахов и химических ноток.</p>
                </div>
                <div class="feature-card fade-in">
                    <div class="feature-icon">
                        <img src="https://lh3.googleusercontent.com/d/1TdyFXe8LHIi1MhY-staABa97WhnpQD6S" alt="Стеклянный флакон">
                    </div>
                    <h3>Стеклянный флакон</h3>
                    <p>Премиальный стеклянный флакон объемом 10 мл с концентрированной парфюмерной композицией. Европейское качество и долговечность.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- 3. Product Catalog -->
    <section id="catalog" class="catalog">
        <div class="container">
            <h2 class="section-title fade-in">ВАШ АРОМАТ-ПОРТРЕТ</h2>
            <div class="products-grid">
                <div class="product-card fade-in" onclick="openProductModal(1)">
                    <div class="product-image">
                        <img src="https://lh3.googleusercontent.com/d/1CdZOZKbopNRF45JOfYviYHFbQ58BXykz" alt="Череп с усами" data-product="1">
                    </div>
                    <div class="product-info">
                        <h3 class="product-name">GENTLEMAN'S CLUB</h3>
                        <p class="product-description">Кожа и табак с нотами виски. Аристократичный аромат для истинных джентльменов дороги.</p>
                    </div>
                </div>

                <div class="product-card fade-in" onclick="openProductModal(2)">
                    <div class="product-image">
                        <img src="https://lh3.googleusercontent.com/d/189JC8uaChk_OO31J5D0z2JkvNGXKegWk" alt="Мото шлем" data-product="2">
                    </div>
                    <div class="product-info">
                        <h3 class="product-name">SPEED & FREEDOM</h3>
                        <p class="product-description">Древесина и металл. Резкий мужской аромат для тех, кто чувствует скорость в крови.</p>
                    </div>
                </div>

                <div class="product-card fade-in" onclick="openProductModal(3)">
                    <div class="product-image">
                        <img src="https://lh3.googleusercontent.com/d/13-RIxoDPkM2whW15aHRenYPMtq-6F52I" alt="Череп в шляпе" data-product="3">
                    </div>
                    <div class="product-info">
                        <h3 class="product-name">DARK COWBOY</h3>
                        <p class="product-description">Кожа, дым и пряности. Брутальный аромат дикого запада с современным характером.</p>
                    </div>
                </div>

                <div class="product-card fade-in" onclick="openProductModal(4)">
                    <div class="product-image">
                        <img src="https://lh3.googleusercontent.com/d/1uyXYkoM11_U6dq3gY1b6nrVDRrsHo30B" alt="Доллар" data-product="4">
                    </div>
                    <div class="product-info">
                        <h3 class="product-name">MONEY POWER</h3>
                        <p class="product-description">Цитрус, имбирь и кедр. Энергичная композиция успеха и уверенности в себе.</p>
                    </div>
                </div>

                <div class="product-card fade-in" onclick="openProductModal(5)">
                    <div class="product-image">
                        <img src="https://lh3.googleusercontent.com/d/1P0UWrtayPvVmCrEB0Hm4P02PhGDqNLB6" alt="Аниме" data-product="5">
                    </div>
                    <div class="product-info">
                        <h3 class="product-name">CHERRY BLOSSOM</h3>
                        <p class="product-description">Сакура, ваниль и мускус. Нежный восточный аромат с загадочным шлейфом.</p>
                    </div>
                </div>

                <div class="product-card fade-in" onclick="openProductModal(6)">
                    <div class="product-image">
                        <img src="https://lh3.googleusercontent.com/d/1Cplsv7FFZyaHt8WQOlhFSJp7EAQu4XEZ" alt="Кот на чиле" data-product="6">
                    </div>
                    <div class="product-info">
                        <h3 class="product-name">COOL CAT VIBES</h3>
                        <p class="product-description">Морская свежесть с нотами кокоса. Расслабляющий аромат вечного лета и беззаботности.</p>
                    </div>
                </div>

                <div class="product-card fade-in" onclick="openProductModal(7)">
                    <div class="product-image">
                        <img src="https://lh3.googleusercontent.com/d/15iT_fyVPR8zrjEVTiUgbBOACgvpWxxUi" alt="Красотка" data-product="7">
                    </div>
                    <div class="product-info">
                        <h3 class="product-name">FEMME FATALE</h3>
                        <p class="product-description">Роза, пачули и амбра. Чувственный аромат для тех, кто ценит элегантность и страсть.</p>
                    </div>
                </div>

                <div class="product-card fade-in" onclick="openProductModal(8)">
                    <div class="product-image">
                        <img src="https://lh3.googleusercontent.com/d/1H6AaLF-cS4fL_y0yJfjFq9GJjfmOF2IX" alt="Медсестра" data-product="8">
                    </div>
                    <div class="product-info">
                        <h3 class="product-name">CLEAN & CARE</h3>
                        <p class="product-description">Лаванда, эвкалипт и белый чай. Свежий антибактериальный аромат чистоты и заботы.</p>
                    </div>
                </div>

                <div class="product-card fade-in" onclick="openProductModal(9)">
                    <div class="product-image">
                        <img src="https://lh3.googleusercontent.com/d/1nUWnQKGFa2h_YnVNv7B7d5T6ldu5fA6F" alt="Клоун" data-product="9">
                    </div>
                    <div class="product-info">
                        <h3 class="product-name">CIRCUS PARTY</h3>
                        <p class="product-description">Сладкая вата, карамель и попкорн. Веселый аромат для тех, кто любит радость и позитив.</p>
                    </div>
                </div>

                <div class="product-card fade-in" onclick="openProductModal(10)">
                    <div class="product-image">
                        <img src="https://lh3.googleusercontent.com/d/1kaztKn1VSm0qviUN4MqFi3b4uPhn3iVl" alt="Обезьяна" data-product="10">
                    </div>
                    <div class="product-info">
                        <h3 class="product-name">JUNGLE SPIRIT</h3>
                        <p class="product-description">Банан, манго и тропические фрукты. Экзотический аромат дикой природы и приключений.</p>
                    </div>
                </div>

                <div class="product-card fade-in" onclick="openProductModal(11)">
                    <div class="product-image">
                        <img src="https://lh3.googleusercontent.com/d/1c8qDxEP6d4ckWV76ykDM6j_gyNdSBsM1" alt="Череп епископом" data-product="11">
                    </div>
                    <div class="product-info">
                        <h3 class="product-name">HOLY SMOKE</h3>
                        <p class="product-description">Ладан, мирра и сандал. Мистический аромат древних храмов и духовных практик.</p>
                    </div>
                </div>

                <div class="product-card fade-in" onclick="openProductModal(12)">
                    <div class="product-image">
                        <img src="https://lh3.googleusercontent.com/d/1fQvIs2MI3ra85fvwJGVXbD0qL1QWBRdP" alt="Попка" data-product="12">
                    </div>
                    <div class="product-info">
                        <h3 class="product-name">PEACH DREAM</h3>
                        <p class="product-description">Персик, абрикос и белый мускус. Сладкий фруктовый аромат нежности и обаяния.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- 4. Usage Experience -->
    <section id="experience" class="experience">
        <div class="container">
            <h2 class="section-title fade-in">РИТУАЛ ПРЕОБРАЖЕНИЯ</h2>
            <div class="steps-container">
                <div class="step-card fade-in">
                    <div class="step-number">1</div>
                    <div class="step-image">📦</div>
                    <h3>РАСПАКОВКА</h3>
                    <p>Роскошная упаковка создает ощущение премиальности с первого прикосновения. Внутри: деревянный диффузор, флакон с ароматом и инструкция.</p>
                </div>
                <div class="step-card fade-in">
                    <div class="step-number">2</div>
                    <div class="step-image">🎯</div>
                    <h3>УСТАНОВКА</h3>
                    <p>Нанесите 5-7 капель на войлочный сердечник и закрепите диффузор на дефлекторе. Элегантный дизайн дополнит любой интерьер.</p>
                </div>
                <div class="step-card fade-in">
                    <div class="step-number">3</div>
                    <div class="step-image">✨</div>
                    <h3>НАСЛАЖДЕНИЕ</h3>
                    <p>Включите климат-контроль и позвольте аромату наполнить салон. Интенсивность регулируется силой воздушного потока.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- 5. Social Proof -->
    <section id="testimonials" class="social-proof">
        <div class="container">
            <h2 class="section-title fade-in">ВЫБОР ЦЕНИТЕЛЕЙ СТИЛЯ</h2>
            <div class="testimonials-grid">
                <div class="testimonial-card fade-in">
                    <p class="testimonial-quote">"Наконец-то нашел достойную альтернативу химическим «елочкам». Аромат сандала держится месяц, салон пахнет как дорогой отель. Гости всегда спрашивают, что это."</p>
                    <div class="testimonial-author">
                        <div class="author-avatar">АК</div>
                        <div class="author-info">
                            <div class="author-name">Александр Ковалев</div>
                            <div class="author-title">Mercedes-Benz S-Class</div>
                        </div>
                    </div>
                </div>

                <div class="testimonial-card fade-in">
                    <p class="testimonial-quote">"Купила «Лаванда и Ваниль» для долгих поездок. Аромат расслабляет, но не усыпляет. Деревянная подвеска выглядит стильно, не как дешевая безделушка."</p>
                    <div class="testimonial-author">
                        <div class="author-avatar">ЕМ</div>
                        <div class="author-info">
                            <div class="author-name">Екатерина Михайлова</div>
                            <div class="author-title">Lexus RX 350</div>
                        </div>
                    </div>
                </div>

                <!-- третий отзыв временно скрыт -->
            </div>
        </div>
    </section>

    <!-- 6. Where to Buy -->
    <section id="buy" class="where-to-buy">
        <div class="container">
            <div class="map-container fade-in">
                <div id="map"></div>
            </div>
            <div class="cta-center">
                <button onclick="findNearestStore()" class="cta-button" id="findStoreBtn">
                    📍 НАЙТИ БЛИЖАЙШИЙ МАГАЗИН
                </button>
                
                <!-- Блок результата -->
                <div id="storeResult" style="display:none; margin-top:30px; padding:30px; background:linear-gradient(145deg, #0a0a0a, #1a1a1a); border:2px solid #C0C0C0; border-radius:15px; box-shadow:0 10px 40px rgba(192,192,192,0.3);">
                    <h3 style="color:#C0C0C0; font-size:24px; margin:0 0 20px 0; text-align:center; letter-spacing:1px;">
                        🎯 БЛИЖАЙШИЙ МАГАЗИН
                    </h3>
                    <div style="background:rgba(192,192,192,0.05); padding:25px; border-radius:10px; border-left:4px solid #C0C0C0;">
                        <p style="color:#C0C0C0; font-size:28px; font-weight:bold; margin:0 0 10px 0;" id="storeName"></p>
                        <p style="color:#E0E0E0; font-size:18px; margin:0 0 15px 0; line-height:1.6;" id="storeAddress"></p>
                        <p style="color:#C0C0C0; font-size:16px; margin:0 0 15px 0;" id="storePhone"></p>
                        <p style="color:#F0F0F0; font-size:32px; font-weight:bold; margin:0; text-align:center; text-shadow:0 0 20px rgba(192,192,192,0.5);" id="storeDistance"></p>
                        <p style="color:#C0C0C0; font-size:16px; margin:10px 0 0 0;" id="storeEtaDriving"></p>
                        <p style="color:#C0C0C0; font-size:16px; margin:6px 0 0 0;" id="storeEtaWalking"></p>
                    </div>
                    <button onclick="openRoute()" class="cta-button" style="width:100%; margin-top:25px; background:linear-gradient(135deg, #C0C0C0, #F0F0F0, #C0C0C0); color:#000;">
                        🗺️ ПОСТРОИТЬ МАРШРУТ
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- 7. Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>О CARFUME</h3>
                <p>Премиальные деревянные ароматизаторы для автомобилей. Натуральные материалы, эксклюзивные композиции, европейское качество.</p>
            </div>
            <div class="footer-section">
                <h3>КОНТАКТЫ</h3>
                <a href="tel:+375291234567">+375 (29) 123-45-67</a>
                <a href="mailto:info@carfume.by">info@carfume.by</a>
                <p>Минск, Беларусь</p>
            </div>
            <div class="footer-section">
                <h3>ИНФОРМАЦИЯ</h3>
                <a href="#">Доставка и оплата</a>
                <a href="#">Гарантии</a>
                <a href="#">Сотрудничество</a>
                <a href="#">Политика конфиденциальности</a>
            </div>
            <div class="footer-section">
                <h3>СОЦИАЛЬНЫЕ СЕТИ</h3>
                <div class="social-links">
                    <a href="#">📘</a>
                    <a href="#">📷</a>
                    <a href="#">✈️</a>
                    <a href="#">▶️</a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 CarFume. Все права защищены. Создано с любовью к деталям.</p>
        </div>
    </footer>

    <script>
        // ===== НАСТРОЙКИ ФОНОВЫХ ТЕКСТУР =====
        const BACKGROUND_URLS = [
            'https://lh3.googleusercontent.com/d/1_osZ6U8leRJWb0fMTUf2UqaflKvNZ-Ox',
            'https://drive.google.com/uc?export=download&id=1_osZ6U8leRJWb0fMTUf2UqaflKvNZ-Ox',
            'https://drive.google.com/uc?export=view&id=1_osZ6U8leRJWb0fMTUf2UqaflKvNZ-Ox'
        ];
        
        // ===== НАСТРОЙКИ ИЗОБРАЖЕНИЙ ПРОДУКТОВ (12 ФОТО) =====
        const PRODUCT_IMAGES = {
            1: 'https://lh3.googleusercontent.com/d/1CdZOZKbopNRF45JOfYviYHFbQ58BXykz',   // GENTLEMAN'S CLUB - Череп с усами
            2: 'https://lh3.googleusercontent.com/d/189JC8uaChk_OO31J5D0z2JkvNGXKegWk',   // SPEED & FREEDOM - Мото шлем
            3: 'https://lh3.googleusercontent.com/d/13-RIxoDPkM2whW15aHRenYPMtq-6F52I',  // DARK COWBOY - Череп в шляпе
            4: 'https://lh3.googleusercontent.com/d/1uyXYkoM11_U6dq3gY1b6nrVDRrsHo30B',   // MONEY POWER - Доллар
            5: 'https://lh3.googleusercontent.com/d/1P0UWrtayPvVmCrEB0Hm4P02PhGDqNLB6',   // CHERRY BLOSSOM - Аниме
            6: 'https://lh3.googleusercontent.com/d/1Cplsv7FFZyaHt8WQOlhFSJp7EAQu4XEZ',   // COOL CAT VIBES - Кот на чиле
            7: 'https://lh3.googleusercontent.com/d/15iT_fyVPR8zrjEVTiUgbBOACgvpWxxUi',   // FEMME FATALE - Красотка
            8: 'https://lh3.googleusercontent.com/d/1H6AaLF-cS4fL_y0yJfjFq9GJjfmOF2IX',   // CLEAN & CARE - Медсестра
            9: 'https://lh3.googleusercontent.com/d/1nUWnQKGFa2h_YnVNv7B7d5T6ldu5fA6F',   // CIRCUS PARTY - Клоун
            10: 'https://lh3.googleusercontent.com/d/1kaztKn1VSm0qviUN4MqFi3b4uPhn3iVl',  // JUNGLE SPIRIT - Обезьяна
            11: 'https://lh3.googleusercontent.com/d/1c8qDxEP6d4ckWV76ykDM6j_gyNdSBsM1',  // HOLY SMOKE - Череп епископом
            12: 'https://lh3.googleusercontent.com/d/1fQvIs2MI3ra85fvwJGVXbD0qL1QWBRdP'   // PEACH DREAM - Попка
        };

        // Функция проверки загрузки изображения
        function testImageLoad(url, callback) {
            const img = new Image();
            img.onload = () => callback(true, url);
            img.onerror = () => callback(false, url);
            img.src = url;
        }

        // Загрузка фоновых изображений
        document.addEventListener('DOMContentLoaded', function() {
            const sectionsWithBg = ['.hero', '.materials', '.catalog', '.experience', '.social-proof', '.where-to-buy'];
            
            function setBackground(url) {
                sectionsWithBg.forEach(selector => {
                    const section = document.querySelector(selector);
                    if (section) {
                        section.style.backgroundImage = `linear-gradient(rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0.85)), url('${url}')`;
                        section.style.backgroundSize = 'cover';
                        section.style.backgroundPosition = 'center';
                        section.style.backgroundAttachment = 'fixed';
                    }
                });
            }
            
            testImageLoad(BACKGROUND_URLS[0], (success, url) => {
                if (success) {
                    setBackground(url);
                } else {
                    testImageLoad(BACKGROUND_URLS[1], (success2, url2) => {
                        if (success2) {
                            setBackground(url2);
                        } else {
                            setBackground(BACKGROUND_URLS[2]);
                        }
                    });
                }
            });
            
            // Автоматическая загрузка изображений продуктов
            const productCards = document.querySelectorAll('.product-card');
            productCards.forEach((card, index) => {
                const img = card.querySelector('img');
                const productId = index + 1;
                if (img && PRODUCT_IMAGES[productId]) {
                    img.src = PRODUCT_IMAGES[productId];
                }
            });
        });

        // Scroll animations
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        try {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                    }
                });
            }, observerOptions);

            document.querySelectorAll('.fade-in').forEach(el => {
                observer.observe(el);
            });
        } catch (e) {
            // Если IntersectionObserver недоступен, показываем элементы сразу
            document.querySelectorAll('.fade-in').forEach(el => el.classList.add('visible'));
        }

        // Navbar scroll effect
        window.addEventListener('scroll', () => {
            const navbar = document.getElementById('navbar');
            if (window.scrollY > 100) {
                navbar.classList.add('scrolled');
            } else {
                navbar.classList.remove('scrolled');
            }
        });

        // Product data
        const productData = {
            1: {
                name: "GENTLEMAN'S CLUB",
                description: "Кожа и табак с нотами виски. Аристократичный аромат для истинных джентльменов дороги.",
                composition: ["Кожа", "Табак листовой", "Виски бурбон", "Сандаловое дерево", "Пачули"],
                features: ["Стойкость: 4-6 недель", "Натуральное дерево ручной работы", "Премиальные парфюмерные масла", "Подходит для салонов премиум-класса"]
            },
            2: {
                name: "SPEED & FREEDOM",
                description: "Древесина и металл. Резкий мужской аромат для тех, кто чувствует скорость в крови.",
                composition: ["Кедр", "Ветивер", "Металлические ноты", "Черный перец", "Мускус"],
                features: ["Энергичный и динамичный аромат", "Для любителей скорости", "Освежает и бодрит", "Идеален для дальних поездок"]
            },
            3: {
                name: "DARK COWBOY",
                description: "Кожа, дым и пряности. Брутальный аромат дикого запада с современным характером.",
                composition: ["Кожа выдержанная", "Дымные ноты", "Корица", "Гвоздика", "Амбра"],
                features: ["Брутальный и мужественный", "Теплый шлейф", "Идеален для вечерних поездок", "Создает атмосферу приключений"]
            },
            4: {
                name: "MONEY POWER",
                description: "Цитрус, имбирь и кедр. Энергичная композиция успеха и уверенности в себе.",
                composition: ["Бергамот", "Грейпфрут", "Имбирь свежий", "Кедр атласский", "Ветивер"],
                features: ["Аромат успеха и амбиций", "Бодрящий и мотивирующий", "Идеален для деловых встреч", "Повышает концентрацию"]
            },
            5: {
                name: "CHERRY BLOSSOM",
                description: "Сакура, ваниль и мускус. Нежный восточный аромат с загадочным шлейфом.",
                composition: ["Цветы сакуры", "Ваниль бурбон", "Белый мускус", "Жасмин", "Сандал"],
                features: ["Нежный и романтичный", "Создает спокойную атмосферу", "Унисекс аромат", "Идеален для комфортных поездок"]
            },
            6: {
                name: "COOL CAT VIBES",
                description: "Морская свежесть с нотами кокоса. Расслабляющий аромат вечного лета и беззаботности.",
                composition: ["Морские ноты", "Кокос", "Бергамот", "Белый чай", "Амбра"],
                features: ["Свежий и расслабляющий", "Летнее настроение круглый год", "Устраняет посторонние запахи", "Создает ощущение отпуска"]
            },
            7: {
                name: "FEMME FATALE",
                description: "Роза, пачули и амбра. Чувственный аромат для тех, кто ценит элегантность и страсть.",
                composition: ["Роза дамасская", "Пачули", "Амбра серая", "Ирис", "Ваниль"],
                features: ["Чувственный и элегантный", "Роскошный шлейф", "Подходит для вечерних выездов", "Создает атмосферу изысканности"]
            },
            8: {
                name: "CLEAN & CARE",
                description: "Лаванда, эвкалипт и белый чай. Свежий антибактериальный аромат чистоты и заботы.",
                composition: ["Лаванда", "Эвкалипт", "Белый чай", "Мята", "Озон"],
                features: ["Чистый и свежий", "Антибактериальные свойства", "Успокаивающий эффект", "Идеален для семейных поездок"]
            },
            9: {
                name: "CIRCUS PARTY",
                description: "Сладкая вата, карамель и попкорн. Веселый аромат для тех, кто любит радость и позитив.",
                composition: ["Сахарная вата", "Карамель", "Попкорн", "Ваниль", "Бензоин"],
                features: ["Сладкий и игривый", "Поднимает настроение", "Идеален для поездок с детьми", "Создает праздничную атмосферу"]
            },
            10: {
                name: "JUNGLE SPIRIT",
                description: "Банан, манго и тропические фрукты. Экзотический аромат дикой природы и приключений.",
                composition: ["Банан", "Манго", "Папайя", "Кокос", "Зеленые листья"],
                features: ["Экзотический и яркий", "Тропическое настроение", "Энергичный и жизнерадостный", "Напоминает о путешествиях"]
            },
            11: {
                name: "HOLY SMOKE",
                description: "Ладан, мирра и сандал. Мистический аромат древних храмов и духовных практик.",
                composition: ["Ладан", "Мирра", "Сандал", "Кедр", "Пачули"],
                features: ["Мистический и глубокий", "Способствует медитации", "Очищает пространство", "Создает умиротворенную атмосферу"]
            },
            12: {
                name: "PEACH DREAM",
                description: "Персик, абрикос и белый мускус. Сладкий фруктовый аромат нежности и обаяния.",
                composition: ["Персик", "Абрикос", "Белый мускус", "Ваниль", "Сандал"],
                features: ["Нежный и сладкий", "Фруктовая свежесть", "Уютный и комфортный", "Подходит для романтических поездок"]
            }
        };

        // Блокировка повторного открытия модалки после закрытия
        let modalOpenLockUntil = 0;

        // Open product modal
        function openProductModal(productId) {
            // Защита от ложных касаний: нельзя открыть раньше, чем через 500 мс после закрытия
            if (Date.now() < modalOpenLockUntil) {
                return;
            }
            const product = productData[productId];
            if (!product) return;

            document.getElementById('modalTitle').textContent = product.name;
            document.getElementById('modalDescription').textContent = product.description;
            document.getElementById('modalImage').src = PRODUCT_IMAGES[productId];
            document.getElementById('modalImage').alt = product.name;

            // Показать блок изображения для товаров
            const modalImageBlock = document.querySelector('.modal-image');
            if (modalImageBlock) modalImageBlock.style.display = 'flex';

            const compositionList = document.getElementById('modalComposition');
            compositionList.innerHTML = '';
            product.composition.forEach(item => {
                const li = document.createElement('li');
                li.textContent = item;
                compositionList.appendChild(li);
            });

            const featuresList = document.getElementById('modalFeatures');
            featuresList.innerHTML = '';
            product.features.forEach(item => {
                const li = document.createElement('li');
                li.textContent = item;
                featuresList.appendChild(li);
            });

            // Всегда показываем секции списков для товаров
            const featuresBlocks = document.querySelectorAll('.modal-features');
            if (featuresBlocks[0]) featuresBlocks[0].style.display = 'block';
            if (featuresBlocks[1]) featuresBlocks[1].style.display = 'block';

            const modal = document.getElementById('productModal');
            const modalCta = document.getElementById('modalCtaBtn');
            if (modalCta) modalCta.style.display = 'inline-block'; // для товаров показываем CTA
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Универсальное открытие модалки для материалов и отзывов
        function openGenericModal(title, description, imageUrl = '', composition = [], features = []) {
            if (Date.now() < modalOpenLockUntil) {
                return;
            }

            const titleEl = document.getElementById('modalTitle');
            const descEl = document.getElementById('modalDescription');
            const imgEl = document.getElementById('modalImage');
            const imageBlock = document.querySelector('.modal-image');
            const compositionList = document.getElementById('modalComposition');
            const featuresList = document.getElementById('modalFeatures');
            const featuresBlocks = document.querySelectorAll('.modal-features');

            if (titleEl) titleEl.textContent = title || '';
            if (descEl) descEl.textContent = description || '';

            if (imageBlock) {
                if (imageUrl) {
                    imageBlock.style.display = 'flex';
                    if (imgEl) {
                        imgEl.src = imageUrl;
                        imgEl.alt = title || '';
                    }
                } else {
                    imageBlock.style.display = 'none';
                }
            }

            if (compositionList) {
                compositionList.innerHTML = '';
                (composition || []).forEach(item => {
                    const li = document.createElement('li');
                    li.textContent = item;
                    compositionList.appendChild(li);
                });
            }

            if (featuresList) {
                featuresList.innerHTML = '';
                (features || []).forEach(item => {
                    const li = document.createElement('li');
                    li.textContent = item;
                    featuresList.appendChild(li);
                });
            }

            // Скрывать пустые секции
            if (featuresBlocks[0]) featuresBlocks[0].style.display = (composition && composition.length) ? 'block' : 'none';
            if (featuresBlocks[1]) featuresBlocks[1].style.display = (features && features.length) ? 'block' : 'none';

            const modal = document.getElementById('productModal');
            const modalCta = document.getElementById('modalCtaBtn');
            if (modalCta) modalCta.style.display = 'none'; // для материалов/отзывов скрываем CTA
            // Сделать модалку компактнее под контент материалов/отзывов
            const modalContent = document.querySelector('.modal-content');
            if (modalContent) {
                modalContent.style.height = 'auto';
                modalContent.style.maxHeight = '88vh';
            }
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Close modal
        function closeModal() {
            const modal = document.getElementById('productModal');
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
            // Ставим задержку 500 мс перед следующим открытием товара
            modalOpenLockUntil = Date.now() + 500;
        }

        // Безопасно навешиваем обработчики после построения DOM
        document.addEventListener('DOMContentLoaded', function() {
            const modalEl = document.getElementById('productModal');
            if (modalEl) {
                // Закрывать модалку по нажатию в любом месте экрана
                const closeAnyTap = () => closeModal();
                modalEl.addEventListener('click', closeAnyTap);
                modalEl.addEventListener('touchstart', closeAnyTap, { passive: true });
            }

            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') closeModal();
            });

            // Кликабельность карточек материалов: открыть полное описание
            document.querySelectorAll('.feature-card').forEach(card => {
                card.addEventListener('click', () => {
                    const title = (card.querySelector('h3') && card.querySelector('h3').textContent) || 'Материал';
                    const desc = (card.querySelector('p') && card.querySelector('p').textContent) || '';
                    const img = (card.querySelector('img') && card.querySelector('img').src) || '';
                    openGenericModal(title, desc, img, [], []);
                });
            });

            // Кликабельность отзывов: открыть полный отзыв
            document.querySelectorAll('.testimonial-card').forEach(card => {
                card.addEventListener('click', () => {
                    const quote = (card.querySelector('.testimonial-quote') && card.querySelector('.testimonial-quote').textContent) || '';
                    const name = (card.querySelector('.author-name') && card.querySelector('.author-name').textContent) || 'Отзыв';
                    const car = (card.querySelector('.author-title') && card.querySelector('.author-title').textContent) || '';
                    const title = car ? `${name} — ${car}` : name;
                    openGenericModal(title, quote, '', [], []);
                });
            });

            const toggle = document.querySelector('.mobile-menu-toggle');
            if (toggle) {
                toggle.addEventListener('click', function() {
                    const navLinks = document.querySelector('.nav-links');
                    if (!navLinks) return;
                    if (navLinks.style.display === 'flex') {
                        navLinks.style.display = 'none';
                    } else {
                        navLinks.style.display = 'flex';
                        navLinks.style.flexDirection = 'column';
                        navLinks.style.position = 'absolute';
                        navLinks.style.top = '100%';
                        navLinks.style.left = '0';
                        navLinks.style.right = '0';
                        navLinks.style.background = 'rgba(0, 0, 0, 0.98)';
                        navLinks.style.padding = '20px';
                    }
                });
            }

            // Smooth scroll для якорей: корректный скролл к карте с учётом фиксированного меню
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    const href = this.getAttribute('href');
                    const target = document.querySelector(href);
                    if (!target) return;

                    e.preventDefault();

                    // Если идём к карте (#buy) — выравниваем так, чтобы верх карты был под шапкой
                    if (href === '#buy') {
                        const navbar = document.getElementById('navbar');
                        const navH = navbar ? navbar.offsetHeight : 0;
                        const top = target.getBoundingClientRect().top + window.pageYOffset - navH;
                        window.scrollTo({ top, behavior: 'smooth' });
                    } else {
                        target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }

                    // Если меню раскрыто (мобильная верстка) — скрыть после выбора
                    const navLinks = document.querySelector('.nav-links');
                    if (navLinks && getComputedStyle(navLinks).position === 'absolute') {
                        navLinks.style.display = 'none';
                    }
                });
            });
        });

        // ===== GOOGLE MAPS INTEGRATION =====
        let map;
        let markers = [];
        let infoWindows = [];
        let userMarker = null;
        let currentRoute = null;

        // Все магазины/точки продаж CarFume (включая ТЦ в Минске)
        const stores = [
            { name: 'Минск', address: 'ТЦ "Галилео", пр-т Независимости, 154', lat: 53.9006, lng: 27.5590, phone: '+375 29 123-45-67' },
            { name: 'Гомель', address: 'ТЦ "Секрет", ул. Советская, 25', lat: 52.4345, lng: 30.9754, phone: '+375 29 234-56-78' },
            { name: 'Брест', address: 'ТЦ "Европа", бул. Шевченко, 8', lat: 52.0976, lng: 23.7340, phone: '+375 29 345-67-89' },
            { name: 'Витебск', address: 'ТЦ "Марко Сити", пр-т Фрунзе, 11', lat: 55.1904, lng: 30.2049, phone: '+375 29 456-78-90' },
            { name: 'Гродно', address: 'ТЦ "Тринити", ул. Горького, 65', lat: 53.6884, lng: 23.8258, phone: '+375 29 567-89-01' },
            { name: 'Могилев', address: 'ТЦ "Атриум", пр-т Мира, 32', lat: 53.9007, lng: 30.3313, phone: '+375 29 678-90-12' },
            // Исправление адреса ТЦ Спектр
            { name: 'ТЦ Спектр (Минск)', address: 'пр-т Независимости, 179, Минск', query: 'ТЦ Спектр, проспект Независимости 179, Минск', lat: null, lng: null, phone: '+375 29 000-00-00' },
            { name: 'Dana Mall (Минск)', address: 'ул. Петра Мстиславца, 11, Минск', lat: 53.9316, lng: 27.6526, phone: '+375 29 000-00-01' }
        ];

        // Инициализация Google Maps
        function initMap() {
            console.log('🗺️ Инициализация Google Maps...');

            // Темная стилизация карты (серебряно-черная тема)
            const darkMapStyles = [
                { elementType: 'geometry', stylers: [{ color: '#1a1a1a' }] },
                { elementType: 'labels.text.stroke', stylers: [{ color: '#000000' }] },
                { elementType: 'labels.text.fill', stylers: [{ color: '#C0C0C0' }] },
                {
                    featureType: 'administrative.locality',
                    elementType: 'labels.text.fill',
                    stylers: [{ color: '#F0F0F0' }]
                },
                {
                    featureType: 'poi',
                    elementType: 'labels.text.fill',
                    stylers: [{ color: '#A8A8A8' }]
                },
                {
                    featureType: 'poi.park',
                    elementType: 'geometry',
                    stylers: [{ color: '#0f0f0f' }]
                },
                {
                    featureType: 'poi.park',
                    elementType: 'labels.text.fill',
                    stylers: [{ color: '#6b6b6b' }]
                },
                {
                    featureType: 'road',
                    elementType: 'geometry',
                    stylers: [{ color: '#2a2a2a' }]
                },
                {
                    featureType: 'road',
                    elementType: 'geometry.stroke',
                    stylers: [{ color: '#1a1a1a' }]
                },
                {
                    featureType: 'road',
                    elementType: 'labels.text.fill',
                    stylers: [{ color: '#8a8a8a' }]
                },
                {
                    featureType: 'road.highway',
                    elementType: 'geometry',
                    stylers: [{ color: '#3a3a3a' }]
                },
                {
                    featureType: 'road.highway',
                    elementType: 'geometry.stroke',
                    stylers: [{ color: '#1f1f1f' }]
                },
                {
                    featureType: 'road.highway',
                    elementType: 'labels.text.fill',
                    stylers: [{ color: '#C0C0C0' }]
                },
                {
                    featureType: 'transit',
                    elementType: 'geometry',
                    stylers: [{ color: '#2a2a2a' }]
                },
                {
                    featureType: 'transit.station',
                    elementType: 'labels.text.fill',
                    stylers: [{ color: '#A8A8A8' }]
                },
                {
                    featureType: 'water',
                    elementType: 'geometry',
                    stylers: [{ color: '#0a0a0a' }]
                },
                {
                    featureType: 'water',
                    elementType: 'labels.text.fill',
                    stylers: [{ color: '#515c6d' }]
                },
                {
                    featureType: 'water',
                    elementType: 'labels.text.stroke',
                    stylers: [{ color: '#000000' }]
                }
                ,
                {
                    featureType: 'administrative.country',
                    elementType: 'geometry.stroke',
                    stylers: [{ color: '#C0C0C0' }] // серебристый контур страны
                }
            ];

            // Создание карты
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 7,
                center: { lat: 53.5, lng: 28.0 }, // Центр Беларуси
                styles: darkMapStyles,
                disableDefaultUI: true,
                zoomControl: true,
                mapTypeControl: false,
                scaleControl: true,
                streetViewControl: false,
                rotateControl: false,
                fullscreenControl: false,
                // Мобильное управление: перемещение одним пальцем
                gestureHandling: 'greedy',
                draggable: true
            });

            // Используем стандартные красные маркеры Google для точек продаж

            // Закрывать любые открытые окна описаний при начале перетаскивания/масштабировании
            const closeAllInfoWindows = () => {
                infoWindows.forEach(iw => iw.close());
            };
            map.addListener('dragstart', closeAllInfoWindows);
            map.addListener('zoom_changed', closeAllInfoWindows);

            // Кнопка "Где я?" (запрос геопозиции и показ синей точки)
            addLocateControl(map);

            // Добавление маркеров для магазинов
            const boundsAll = new google.maps.LatLngBounds();
            const service = new google.maps.places.PlacesService(map);
            stores.forEach((store, index) => {
                const createMarker = (lat, lng) => {
                    const marker = new google.maps.Marker({
                        position: { lat, lng },
                        map: map,
                        title: store.name,
                        animation: google.maps.Animation.DROP
                    });
                    boundsAll.extend({ lat, lng });
                    const infoWindow = new google.maps.InfoWindow({
                        content: `
                            <div style="font-family: Arial, sans-serif; padding: 10px; min-width: 250px;">
                                <h3 style="margin: 0 0 10px 0; color: #000; font-size: 18px; font-weight: bold;">${store.name}</h3>
                                <p style="margin: 5px 0; color: #333; font-size: 14px;">📍 ${store.address}</p>
                                <p style="margin: 5px 0; color: #333; font-size: 14px;">📞 ${store.phone}</p>
                                <button onclick="openRouteFromMap(${lat}, ${lng})" style="margin-top:10px;padding:10px 20px;background:linear-gradient(135deg,#C0C0C0,#F0F0F0);color:#000;border:none;border-radius:8px;cursor:pointer;font-weight:bold;font-size:14px;width:100%;transition:all .3s ease;">🗺️ ПОСТРОИТЬ МАРШРУТ</button>
                            </div>`
                    });
                    marker.addListener('click', () => {
                        infoWindows.forEach(iw => iw.close());
                        infoWindow.open(map, marker);
                    });
                    markers.push(marker);
                    infoWindows.push(infoWindow);
                };

                if (store.lat != null && store.lng != null) {
                    createMarker(store.lat, store.lng);
                } else {
                    const query = store.query || `${store.name}, ${store.address}`;
                    service.textSearch({ query, region: 'by', language: 'ru' }, (results, status) => {
                        if (status === google.maps.places.PlacesServiceStatus.OK && results && results[0]) {
                            const pos = results[0].geometry.location;
                            store.lat = pos.lat();
                            store.lng = pos.lng();
                            createMarker(store.lat, store.lng);
                        } else {
                            console.warn('Не найден объект по запросу:', query);
                        }
                    });
                }
            });

            // Подгоняем карту сразу по всем магазинам
            if (!boundsAll.isEmpty()) {
                map.fitBounds(boundsAll);
                // Немного отъедем, чтобы не было слишком близко
                google.maps.event.addListenerOnce(map, 'bounds_changed', () => {
                    if (map.getZoom() > 10) map.setZoom(8);
                });
            }

            console.log('✅ Google Maps инициализирована!');
            console.log(`📍 Добавлено маркеров: ${markers.length}`);

            // Добавление доп. объектов через Places API
            // Пробуем через Places API (не обязательно, т.к. ТЦ уже в stores)
            addPlaceByText('ТЦ Спектр, Минск, Беларусь', boundsAll);
            addPlaceByText('Dana Mall, Минск, Беларусь', boundsAll);
        }

        // Кастомная кнопка "Где я?" в правом верхнем углу
        function addLocateControl(mapRef) {
            const controlDiv = document.createElement('div');
            const btn = document.createElement('button');
            btn.textContent = 'Где я?';
            btn.setAttribute('aria-label', 'Где я?');
            btn.style.cssText = `
                background:#fff;color:#000;border:1px solid #ccc;border-radius:8px;
                padding:8px 12px;font-size:12px;font-weight:600;cursor:pointer;
                box-shadow:0 2px 6px rgba(0,0,0,0.3);margin:10px; user-select:none;
            `;
            btn.onmouseenter = () => btn.style.background = '#f5f5f5';
            btn.onmouseleave = () => btn.style.background = '#fff';
            controlDiv.appendChild(btn);
            // Размещаем кнопку прямо над zoom (+/-) справа снизу
            mapRef.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(controlDiv);

            btn.addEventListener('click', () => {
                if (!navigator.geolocation) {
                    alert('❌ Геолокация не поддерживается вашим браузером.');
                    return;
                }
                navigator.geolocation.getCurrentPosition(pos => {
                    const userLat = pos.coords.latitude;
                    const userLng = pos.coords.longitude;
                    if (userMarker) userMarker.setMap(null);
                    userMarker = new google.maps.Marker({
                        position: { lat: userLat, lng: userLng },
                        map: mapRef,
                        title: 'Вы здесь',
                        icon: { path: google.maps.SymbolPath.CIRCLE, scale: 8, fillColor: '#4285F4', fillOpacity: 1, strokeColor: '#FFFFFF', strokeWeight: 2 }
                    });
                    // Плавное перемещение к пользователю без резкого прыжка
                    const target = { lat: userLat, lng: userLng };
                    const start = mapRef.getCenter();
                    const steps = 30; // ~300ms при 10ms интервале
                    let i = 0;
                    const interp = (a, b, t) => a + (b - a) * t;
                    const anim = setInterval(() => {
                        i++;
                        const t = i / steps;
                        const lat = interp(start.lat(), target.lat, t);
                        const lng = interp(start.lng(), target.lng, t);
                        mapRef.panTo({ lat, lng });
                        if (i >= steps) {
                            clearInterval(anim);
                            // Установим масштаб так, чтобы радиус области был ~30 км
                            // Преобразуем радиус в степень масштаба (грубая аппроксимация для широты Беларуси)
                            // Веб Меркатор: метры на пиксель зависят от зума. Возьмем комфортно: zoom ≈ 11 для ~30км области
                            const targetZoom = 11; // 11-12 — видимый радиус около 30 км
                            if (mapRef.getZoom() !== targetZoom) {
                                mapRef.setZoom(targetZoom);
                            }
                        }
                    }, 10);
                }, err => {
                    alert('Не удалось определить местоположение: ' + err.message);
                }, { enableHighAccuracy: true, timeout: 20000, maximumAge: 0 });
            });
        }

        // Функция для построения маршрута из info window
        window.openRouteFromMap = function(destLat, destLng) {
            if (userMarker) {
                const userPos = userMarker.getPosition();
                const mapsUrl = `https://www.google.com/maps/dir/?api=1&origin=${userPos.lat()},${userPos.lng()}&destination=${destLat},${destLng}&travelmode=driving`;
                window.open(mapsUrl, '_blank');
            } else {
                // Если нет геолокации, просто открываем маршрут до магазина
                const mapsUrl = `https://www.google.com/maps/dir/?api=1&destination=${destLat},${destLng}&travelmode=driving`;
                window.open(mapsUrl, '_blank');
            }
        };

        // Поиск места по текстовому запросу (Places API) и добавление классического маркера
        function addPlaceByText(query, boundsAll) {
            if (!google.maps.places) {
                console.warn('⚠️ Places library не загружена');
                return;
            }
            const service = new google.maps.places.PlacesService(map);
            service.textSearch({ query: query, region: 'by', language: 'ru' }, (results, status) => {
                if (status === google.maps.places.PlacesServiceStatus.OK && results && results.length) {
                    const place = results[0];
                    const pos = place.geometry.location;
                    const marker = new google.maps.Marker({ map, position: pos, title: place.name, animation: google.maps.Animation.DROP });
                    const infoWindow = new google.maps.InfoWindow({
                        content: `
                            <div style="font-family: Arial, sans-serif; padding: 10px; min-width: 260px;">
                                <h3 style="margin:0 0 8px 0; font-size:18px; color:#000;">${place.name}</h3>
                                <p style="margin:0 0 6px 0; color:#333; font-size:14px;">📍 ${place.formatted_address || ''}</p>
                                <button onclick="openRouteFromMap(${pos.lat()}, ${pos.lng()})" style="margin-top:6px;padding:8px 14px;background:linear-gradient(135deg,#C0C0C0,#F0F0F0);color:#000;border:none;border-radius:8px;cursor:pointer;font-weight:bold;">🗺️ ПОСТРОИТЬ МАРШРУТ</button>
                            </div>
                        `
                    });
                    marker.addListener('click', () => {
                        infoWindows.forEach(iw => iw.close());
                        infoWindow.open(map, marker);
                    });
                    markers.push(marker);
                    infoWindows.push(infoWindow);
                    if (boundsAll) {
                        boundsAll.extend(pos);
                        map.fitBounds(boundsAll);
                    }
                    console.log(`✅ Добавлен объект: ${place.name}`);
                } else {
                    console.warn(`⚠️ Не найден объект по запросу: ${query}`);
                }
            });
        }

        // Резервное добавление маркера по координатам
        function addFallbackMarker(place, boundsAll) {
            const pos = new google.maps.LatLng(place.lat, place.lng);
            const marker = new google.maps.Marker({ map, position: pos, title: place.name, icon: storeIcon, animation: google.maps.Animation.DROP });
            const infoWindow = new google.maps.InfoWindow({
                content: `
                    <div style="font-family: Arial, sans-serif; padding: 10px; min-width: 260px;">
                        <h3 style="margin:0 0 8px 0; font-size:18px; color:#000;">${place.name}</h3>
                        <p style="margin:0 0 6px 0; color:#333; font-size:14px;">📍 ${place.address}</p>
                        <button onclick="openRouteFromMap(${place.lat}, ${place.lng})" style="margin-top:6px;padding:8px 14px;background:linear-gradient(135deg,#C0C0C0,#F0F0F0);color:#000;border:none;border-radius:8px;cursor:pointer;font-weight:bold;">🗺️ ПОСТРОИТЬ МАРШРУТ</button>
                    </div>
                `
            });
            marker.addListener('click', () => {
                infoWindows.forEach(iw => iw.close());
                infoWindow.open(map, marker);
            });
            markers.push(marker);
            infoWindows.push(infoWindow);
            if (boundsAll) {
                boundsAll.extend(pos);
                map.fitBounds(boundsAll);
            }
            console.log(`✅ Добавлен резервный объект: ${place.name}`);
        }

        // Загрузка и отрисовка контура Беларуси из GeoJSON
        // Убрали загрузку внешнего GeoJSON, чтобы исключить CORS/404.
        // Серебристый контур задается стилем administrative.country.geometry.stroke в стилях карты.

        // Формула Haversine для точного расстояния между точками
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Радиус Земли в км
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // Расчёт ETA через Distance Matrix API (авто/пешком)
        function getEta(origin, destination, travelMode) {
            return new Promise(resolve => {
                if (!google || !google.maps || !google.maps.DistanceMatrixService) {
                    resolve(null);
                    return;
                }
                const service = new google.maps.DistanceMatrixService();
                service.getDistanceMatrix({
                    origins: [origin],
                    destinations: [destination],
                    travelMode: travelMode,
                    unitSystem: google.maps.UnitSystem.METRIC
                }, (response, status) => {
                    const ok = status === google.maps.DistanceMatrixStatus.OK;
                    const el = ok && response && response.rows && response.rows[0] && response.rows[0].elements && response.rows[0].elements[0];
                    if (ok && el && el.status === 'OK') {
                        resolve({ durationText: el.duration.text, distanceText: el.distance.text });
                    } else {
                        resolve(null);
                    }
                });
            });
        }

        function computeEtas(userLat, userLng, destLat, destLng) {
            const origin = new google.maps.LatLng(userLat, userLng);
            const dest = new google.maps.LatLng(destLat, destLng);
            return Promise.all([
                getEta(origin, dest, google.maps.TravelMode.DRIVING),
                getEta(origin, dest, google.maps.TravelMode.WALKING)
            ]).then(([driving, walking]) => ({ driving, walking }));
        }

        // Рендер содержимого InfoWindow для ближайшего магазина
        function renderNearestInfo(store, walking, driving) {
            const walkingText = walking ? `🚶 Пешком: ${walking.durationText} (${walking.distanceText})` : '🚶 Рассчитываем пешком...';
            const drivingText = driving ? `🚗 На авто: ${driving.durationText} (${driving.distanceText})` : '🚗 Рассчитываем время в пути...';
            return `
                <div style="font-family: Arial, sans-serif; padding: 10px; min-width: 260px;">
                    <div style="font-size:12px; font-weight:700; color:#666; letter-spacing: .5px; text-transform:uppercase; margin-bottom:4px;">Ближайший</div>
                    <h3 style="margin: 0 0 8px 0; color: #000; font-size: 18px; font-weight: bold;">${store.name}</h3>
                    <p style="margin: 4px 0; color: #333; font-size: 14px;">📍 ${store.address}</p>
                    <p style="margin: 4px 0; color: #333; font-size: 14px;">📞 ${store.phone}</p>
                    <p style="margin: 6px 0 0 0; color:#111; font-size: 14px;">${walkingText}</p>
                    <p style="margin: 2px 0 10px 0; color:#111; font-size: 14px;">${drivingText}</p>
                    <button 
                        onclick="openRouteFromMap(${store.lat}, ${store.lng})" 
                        style="
                            display:block; width:100%; margin-top: 2px; padding: 10px 16px;
                            background: linear-gradient(135deg, #C0C0C0, #F0F0F0);
                            color: #000; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 14px;
                        "
                        onmouseover="this.style.transform='scale(1.02)'"
                        onmouseout="this.style.transform='scale(1)'"
                    >
                        <span style="display:inline-block; margin-right:6px;">↪️</span>ПОСТРОИТЬ МАРШРУТ
                    </button>
                </div>
            `;
        }

        function findNearestStore() {
            // Визуальная обратная связь: на 500мс делаем кнопку тёмной
            try {
                const b = document.getElementById('findStoreBtn');
                if (b) {
                    b.classList.add('pressed-dark');
                    setTimeout(() => b.classList.remove('pressed-dark'), 500);
                }
            } catch (_) {}

            const btn = document.getElementById('findStoreBtn');
            const resultBlock = document.getElementById('storeResult');
            const originalText = btn.innerHTML;
            
            if (!navigator.geolocation) {
                alert('❌ Ваш браузер не поддерживает геолокацию.\n\nПожалуйста, используйте современный браузер.');
                return;
            }

            resultBlock.style.display = 'none';
            btn.innerHTML = '⏳ Определяем местоположение...';
            btn.disabled = true;

            navigator.geolocation.getCurrentPosition(
                function(position) {
                    const userLat = position.coords.latitude;
                    const userLng = position.coords.longitude;

                    console.log('📍 Местоположение пользователя:', userLat, userLng);

                    let nearestStore = null;
                    let nearestStoreIndex = -1;
                    let minDistance = Infinity;

                    // Используем сферическое расстояние Google, если доступно, иначе Haversine
                    stores.forEach((store, index) => {
                        let distance;
                        if (google && google.maps && google.maps.geometry && google.maps.geometry.spherical) {
                            distance = google.maps.geometry.spherical.computeDistanceBetween(
                                new google.maps.LatLng(userLat, userLng),
                                new google.maps.LatLng(store.lat, store.lng)
                            ) / 1000; // в км
                        } else {
                            distance = calculateDistance(userLat, userLng, store.lat, store.lng);
                        }
                        if (distance < minDistance) {
                            minDistance = distance;
                            nearestStore = store;
                            nearestStoreIndex = index;
                        }
                    });

                    if (nearestStore) {
                        const distanceKm = (Math.round(minDistance * 10) / 10).toFixed(1);
                        currentRoute = {
                            from: { lat: userLat, lng: userLng },
                            to: { lat: nearestStore.lat, lng: nearestStore.lng }
                        };

                        console.log('🎯 Ближайший магазин:', nearestStore.name, '- расстояние:', distanceKm, 'км');

                        // ===== ИНТЕГРАЦИЯ С КАРТОЙ =====
                        if (map && markers[nearestStoreIndex]) {
                            // Удаляем старый маркер пользователя, если есть
                            if (userMarker) {
                                userMarker.setMap(null);
                            }

                            // Добавляем маркер пользователя (синий)
                            userMarker = new google.maps.Marker({
                                position: { lat: userLat, lng: userLng },
                                map: map,
                                title: 'Ваше местоположение',
                                icon: {
                                    path: google.maps.SymbolPath.CIRCLE,
                                    scale: 8,
                                    fillColor: '#4285F4',
                                    fillOpacity: 1,
                                    strokeColor: '#FFFFFF',
                                    strokeWeight: 2
                                },
                                animation: google.maps.Animation.DROP
                            });

                            // Плавно панорамируем к пользователю (чтобы визуально отследить исходную точку)
                            const startCenter = map.getCenter();
                            const targetCenter = new google.maps.LatLng(userLat, userLng);
                            const steps = 30;
                            let step = 0;
                            const tween = setInterval(() => {
                                step++;
                                const t = step / steps;
                                const lat = startCenter.lat() + (targetCenter.lat() - startCenter.lat()) * t;
                                const lng = startCenter.lng() + (targetCenter.lng() - startCenter.lng()) * t;
                                map.panTo({ lat, lng });
                                if (step >= steps) clearInterval(tween);
                            }, 10);
                            
                            // Мягко выставим комфортный zoom
                            setTimeout(() => { if (map.getZoom() > 12) map.setZoom(12); }, 400);

                            // Открываем окно ближайшего магазина на карте с детальной разметкой
                            setTimeout(() => {
                                infoWindows.forEach(iw => iw.close());
                                const iw = infoWindows[nearestStoreIndex];
                                if (iw) {
                                    // Показать заглушку без ETA
                                    iw.setContent(renderNearestInfo(nearestStore, null, null));
                                    iw.open(map, markers[nearestStoreIndex]);
                                    // Досчитать ETA и обновить контент
                                    computeEtas(userLat, userLng, nearestStore.lat, nearestStore.lng)
                                        .then(({ driving, walking }) => {
                                            iw.setContent(renderNearestInfo(nearestStore, walking, driving));
                                        })
                                        .catch(() => {/* ignore */});
                                }
                            }, 800);

                            console.log('🗺️ Карта обновлена: открыто окно магазина (без автоцентрирования)', nearestStore.name);
                        }

                        try {
                            if (false && resultBlock && document.getElementById('storeName')) {
                                document.getElementById('storeName').textContent = nearestStore.name;
                                document.getElementById('storeAddress').textContent = nearestStore.address;
                                document.getElementById('storePhone').textContent = `📞 ${nearestStore.phone}`;
                                document.getElementById('storeDistance').textContent = `📍 ${distanceKm} км`;
                                // Сброс ETA перед расчетом
                                const etaDrivingEl = document.getElementById('storeEtaDriving');
                                const etaWalkingEl = document.getElementById('storeEtaWalking');
                                if (etaDrivingEl) etaDrivingEl.textContent = '🚗 Рассчитываем время в пути...';
                                if (etaWalkingEl) etaWalkingEl.textContent = '🚶 Рассчитываем пешком...';
                                
                                resultBlock.style.display = 'block';
                                resultBlock.style.opacity = '0';
                                setTimeout(() => {
                                    resultBlock.style.transition = 'opacity 0.5s ease';
                                    resultBlock.style.opacity = '1';
                                }, 10);
                                setTimeout(() => {
                                    resultBlock.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                                }, 300);

                                // Асинхронно считаем ETA и дописываем в блок
                                computeEtas(userLat, userLng, nearestStore.lat, nearestStore.lng)
                                    .then(({ driving, walking }) => {
                                        if (etaWalkingEl && walking) etaWalkingEl.textContent = `🚶 Пешком: ${walking.durationText} (${walking.distanceText})`;
                                        if (etaDrivingEl && driving) etaDrivingEl.textContent = `🚗 На авто: ${driving.durationText} (${driving.distanceText})`;
                                    })
                                    .catch(() => {
                                        if (etaWalkingEl) etaWalkingEl.textContent = '';
                                        if (etaDrivingEl) etaDrivingEl.textContent = '';
                                    });
                            } else {
                                // Не показываем никаких диалоговых окон — вся информация показана в окне на карте
                            }

                            btn.innerHTML = '✅ Готово!';
                            setTimeout(() => {
                                btn.innerHTML = originalText;
                                btn.disabled = false;
                            }, 1500);

                        } catch (e) {
                            console.error('❌ Ошибка отображения результата:', e);
                            alert(`❌ Ошибка отображения\n\nНо мы нашли:\n${nearestStore.name}\n${nearestStore.address}\n\nРасстояние: ${distanceKm} км`);
                            btn.innerHTML = originalText;
                            btn.disabled = false;
                        }
                    }
                },
                function(error) {
                    console.error('❌ Ошибка геолокации:', error);
                    let errorMsg = '';
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMsg = '❌ Вы запретили доступ к местоположению.\n\nРазрешите доступ в настройках браузера и попробуйте снова.';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMsg = '❌ Не удалось определить местоположение.\n\nПроверьте настройки GPS или подключение к интернету.';
                            break;
                        case error.TIMEOUT:
                            errorMsg = '❌ Истекло время ожидания (30 сек).\n\nПопробуйте снова или проверьте соединение с интернетом.';
                            break;
                        default:
                            errorMsg = '❌ Неизвестная ошибка определения местоположения.\n\nПопробуйте обновить страницу.';
                    }
                    alert(errorMsg);
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                },
                {
                    enableHighAccuracy: true,
                    timeout: 30000,
                    maximumAge: 0
                }
            );
        }

        // Открыть маршрут в Google Maps
        function openRoute() {
            if (currentRoute) {
                const mapsUrl = `https://www.google.com/maps/dir/?api=1&origin=${currentRoute.from.lat},${currentRoute.from.lng}&destination=${currentRoute.to.lat},${currentRoute.to.lng}&travelmode=driving`;
                window.open(mapsUrl, '_blank');
            }
        }
    </script>

    <!-- Modal Window -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-close" onclick="closeModal()">×</div>
            <div class="modal-body">
                <div class="modal-image">
                    <img id="modalImage" src="" alt="">
                </div>
                <div class="modal-info">
                    <h2 class="modal-title" id="modalTitle"></h2>
                    <p class="modal-description" id="modalDescription"></p>
                    <div class="modal-features">
                        <h4>Состав композиции:</h4>
                        <ul id="modalComposition"></ul>
                    </div>
                    <div class="modal-features">
                        <h4>Особенности:</h4>
                        <ul id="modalFeatures"></ul>
                    </div>
                    <button class="modal-button" id="modalCtaBtn" onclick="alert('Переход в магазин...')">НАЙТИ В МАГАЗИНЕ</button>
                    <button class="modal-close-bottom" onclick="closeModal()">ЗАКРЫТЬ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Google Maps API -->
    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBfZfUf7ESlGLoJoBE3gMFEdyqCfePR7KQ&callback=initMap&libraries=places,geometry"
        defer>
    </script>
</body>
</html>

